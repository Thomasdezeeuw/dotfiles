#
# # Environment variables
#

# Add user bin to path.
PATH="$HOME/bin:$PATH"

# Vim as the editor.
export EDITOR="vim"
export VISUAL="$EDITOR"
export GIT_EDITOR="$EDITOR"

# Boring language stuff.
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

# Pretty colors, yey!
export CLICOLOR=1

# Determine what shell we're using.
if [ -n "$BASH_VERSION" ] ; then
	shell="bash"
elif [ -n "$ZSH_VERSION" ] ; then
	shell="zsh"
else
	echo "Unknown shell, only supports bash or zsh" >&2
	exit 1
fi

#
# # Profile extensions
#

if [ $shell = "bash" ]; then
	PROFILE_ROOT=$(dirname ${BASH_SOURCE[0]})
elif [ $shell = "zsh" ]; then
	PROFILE_ROOT=$(dirname ${(%):-%N})
fi

# Load programming language specific profile extensions.
for file in $PROFILE_ROOT/lang/*; do
	source "$file"
done

# Load OS specific profile extensions.
OS=$(uname -s | tr "[:upper:]" "[:lower:]")
source "$PROFILE_ROOT/os/$OS"

#
# # Commands and aliases
#

alias tmpdir='cd $(mktemp -d)' # Create a temporary directory and cd into it.
alias q="exit"                # Quick exit.
alias ls="exa"                # I prefer exa.
alias la="ls -a"              # Show me all the things!
alias l="ls -l"               # Quick list.
alias vim="vim -p"            # Open each file in a separate tab.
alias e="vim"                 # I got super lazy.
# Setup ssh agent.
alias setup_ssh='eval `ssh-agent -s` > /dev/null && ssh-add'
# Use sftp instead.
alias scp=sftp
# Use different notes directory.
alias notes="NOTES_ROOT=~/src/notes/weekly notes"

# Overwrites the `rm` command, but only in the shell not in scripts.
rm() {
	echo "Did you mean 'trash'?"
	return 1
}

#
# # Prompt utils.
#

# The current git branch.
git_branch() {
	git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1 /'
}

# Get a clean directory for the prompt.
# When in a git repo this removes everything before the start of the root of the
# repo, also replaces the home directory with "~".
prompt_dir() {
	# Determine if we're in a git repo. If so we get the full path to the repo,
	# or we'll have an empty string.
	local GIT_DIR=$(git rev-parse --show-toplevel 2> /dev/null)
	# Next we determine what part of the path we can remove, e.g. given a
	# `GIT_DIR` of "~/src/repo_root" this will be "~/src".
	local GIT_TRIM_DIR=$(printf "$GIT_DIR" | rev | cut -d'/' -f2- | rev)

	# If we're in a git repo we'll remove the entire path up to the repo root
	# directory, e.g. "~/src/repo_root/src" becomes "repo_root/src".
	local PWD=$(pwd -P)
	local DIR=${PWD#${GIT_TRIM_DIR}}

	# Replace the home directory path with "~/".
	local DIR=${DIR/$HOME/\~\/}
	# Remove the last "/".
	local DIR=${DIR/\//}

	printf "$DIR"
}
